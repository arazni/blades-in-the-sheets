@page "/characters/{Id}"
@using Models.Characters
@using Persistence.Json;
@using UI.Components
@using UI.Components.NewCharacter
@using UI.Services
@using UI.ViewModels
@using static UI.Constants;
@inject IStorageService Storage
@inject ICharacterCoordinator Coordinator
@inject NavigationManager Navigator

<MudHidden Breakpoint="Breakpoint.SmAndDown">
	<MudTimeline TimelinePosition="@TimelinePosition.Start">
		<MudTimelineItem>
			<NewCharacterHeritageCard Heritage="@Character.Dossier.Heritage" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterBackgroundCard Background="@Character.Dossier.Background" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterActionDotsCard Character="@Character" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterSpecialAbilityCard Playbook="@Character.Playbook" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterFriendsCard Rolodex="@Character.Rolodex" PlaybookName="@Character.Playbook.Name" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterViceCard Vice="@Character.Dossier.Vice" />
		</MudTimelineItem>
		<MudTimelineItem>
			<NewCharacterIdentificationCard Dossier="@Character.Dossier" />
		</MudTimelineItem>
		<MudTimelineItem>
			<MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" FullWidth="true" OnClick="SaveAsync">
				Finish your scoundrel
			</MudButton>
		</MudTimelineItem>
	</MudTimeline>
</MudHidden>

<MudHidden Breakpoint="Breakpoint.MdAndUp">
	<MudStack>
		<NewCharacterHeritageCard Heritage="@Character.Dossier.Heritage" />
		<NewCharacterBackgroundCard Background="@Character.Dossier.Background" />
		<NewCharacterActionDotsCard Character="@Character" />
		<NewCharacterSpecialAbilityCard Playbook="@Character.Playbook" />
		<NewCharacterFriendsCard Rolodex="@Character.Rolodex" PlaybookName="@Character.Playbook.Name" />
		<NewCharacterViceCard Vice="@Character.Dossier.Vice" />
		<NewCharacterIdentificationCard Dossier="@Character.Dossier" />
		<MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" FullWidth="true" OnClick="SaveAsync">
			Finish your scoundrel
		</MudButton>
	</MudStack>
</MudHidden>

@code
{
	[Parameter, EditorRequired]
	public string Id { get; set; } = string.Empty;

	public Character Character { get; private set; } = Character.Empty();

	protected override async Task OnInitializedAsync()
	{
		Character = await Storage.Load(Id);
		await base.OnInitializedAsync();
	}

	public async Task SaveAsync()
	{
		await Storage.Save(Character);
		Navigator.NavigateTo(Paths.Sheet(Character.Id));
	}
}
