@page "/sheets/{Id}"
@using Models.Characters
@using UI.Components
@using UI.Components.CharacterSheet
@using UI.Services
@inject IStorageService Storage

@if (Character == null) { return; }

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
	<MudGrid>
		<MudItem xs="12" lg="6">
			<MudStack>
				<SheetDossierCard Dossier="Character.Dossier" />
				<SheetMonitorCard Character="Character" />
				<SheetTalentCard Talent="Character.Talent" />
				<SheetAbilitiesCard Character="Character" />
			</MudStack>
		</MudItem>
		<MudItem xs="12" lg="6">
			<MudStack>
				<SheetRolodexCard Rolodex="Character.Rolodex" Playbook="Character.Playbook.Name" />
				<SheetGearCard Character="Character" Playbook="Character.Playbook.Name" />
				<SheetFundCard Fund="Character.Fund" />
				<SheetNotebookCard Character="Character" />
			</MudStack>
		</MudItem>
	</MudGrid>
	<MudFab Color="SaveButtonColor" StartIcon="@SaveIcon" OnClick="Save" Style="position: fixed; right: 20px; bottom: 20px;" Title="Save Character" />
</MudContainer>

@code
{
	[Parameter, EditorRequired]
	public string Id { get; set; } = string.Empty;

	public Character? Character { get; set; }

	private bool isSaving = false;

	Color SaveButtonColor => isSaving ? Color.Success
		: Color.Tertiary;

	string SaveIcon => isSaving ? Icons.Material.Filled.CheckCircle
		: Icons.Material.Filled.Save;

	protected override async Task OnInitializedAsync()
	{
		Character = await Storage.Load(Id);
	}

	async Task Save()
	{
		isSaving = true;
		await Storage.Save(Character!);
		await Task.Delay(1000);
		isSaving = false;
	}
}
