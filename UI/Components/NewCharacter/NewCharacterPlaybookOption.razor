@using Models.Characters
@using Models.Settings;
@using Persistence.Json;
@using UI.Services
@using static UI.Constants;
@inject IStorageService Storage
@inject ICharacterCoordinator Coordinator
@inject NavigationManager Navigator

<MudCard Outlined="true" Class="mx-4 my-1">
	<MudCardHeader >
		<MudText Typo="Typo.h4">@PlaybookName</MudText>
	</MudCardHeader>
	<MudCardContent>
		<MudText Typo="Typo.body1" Class="my-2">@Hook[..(Hook.IndexOf(".")+1)]</MudText>
		<MudText Typo="Typo.body1" Class="my-2">@Hook[(Hook.IndexOf(".")+1)..]</MudText>
	</MudCardContent>
	<MudCardActions>
		<MudButton Color="Color.Primary" FullWidth="true" OnClick="CreateCharacter">Create @PlaybookName</MudButton>
	</MudCardActions>
</MudCard>

@code
{
	[Parameter, EditorRequired]
	public string PlaybookName { get; set; } = string.Empty;

	[Parameter, EditorRequired]
	public GameSetting GameSetting { get; set; } = EmptyGameSetting.Game();

	[Parameter, EditorRequired]
	public string Hook { get; set; } = string.Empty;

	public async Task CreateCharacter()
	{
		var character = Coordinator.InitializeCharacter(GameSetting, PlaybookName);
		await Storage.Save(character);
		Navigator.NavigateTo(Paths.Character(character.Id));
	}
}
