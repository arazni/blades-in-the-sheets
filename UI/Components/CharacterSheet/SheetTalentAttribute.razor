@using Models.Characters
@using System.Diagnostics.CodeAnalysis
@using UI.Services
@inject SheetJank SheetJank;
@implements IDisposable

<MudStack>
	<MudRating @bind-SelectedValue="Attribute.Experience.Points" MaxValue="Attribute!.Experience.MaxPoints" FullIcon="@Icons.Material.Filled.CheckBox" EmptyIcon="@Icons.Material.Filled.CheckBoxOutlineBlank" Color="Color.Primary" />
	<MudText Typo="Typo.h6">@Attribute.Rating @Name</MudText>
	<SheetTalentAction Attribute="Attribute" ActionName="ActionNames[0]" />
	<SheetTalentAction Attribute="Attribute" ActionName="ActionNames[1]" />
	<SheetTalentAction Attribute="Attribute" ActionName="ActionNames[2]" />
	<SheetTalentAction Attribute="Attribute" ActionName="ActionNames[3]" />
</MudStack>

@code
{
	[Parameter, EditorRequired]
	public TalentAttribute? Attribute { get; set; }

	[Parameter, EditorRequired]
	public string Name { get; set; } = string.Empty;

	[CascadingParameter(Name = "IsFixMode")]
	public bool IsFixMode { get; set; }

	string[] ActionNames { get; set; }
		= Array.Empty<string>();

	protected override void OnInitialized()
	{
		SheetJank.AttributeChanged += AttributeHasChanged;

		base.OnInitialized();
	}

	public void Dispose()
	{
		SheetJank.AttributeChanged -= AttributeHasChanged;
	}

	private void AttributeHasChanged(string attributeName)
	{
		if (attributeName == Name)
			StateHasChanged();
	}
}
